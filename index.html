<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ouverture du rail Ã  la concurrence en France</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.1em;
            opacity: 0.9;
            font-weight: 300;
        }
        
        .main-content {
            display: flex;
            height: calc(100vh - 200px);
        }
        
        .sidebar {
            width: 350px;
            background: #f8f9fa;
            padding: 25px;
            overflow-y: auto;
            border-right: 1px solid #dee2e6;
        }
        
        #map {
            flex: 1;
            height: 100%;
        }
        
        .legend {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }
        
        .legend h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 12px 0;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .legend-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }
        
        .legend-color {
            width: 40px;
            height: 4px;
            margin-right: 12px;
            border-radius: 2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .legend-label {
            flex: 1;
            font-size: 0.95em;
            font-weight: 500;
        }
        
        .legend-count {
            background: #667eea;
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .stats {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .stats h3 {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 3px solid #764ba2;
            padding-bottom: 10px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px;
            margin: 8px 0;
            background: #f8f9fa;
            border-radius: 6px;
            border-left: 4px solid #667eea;
        }
        
        .stat-label {
            font-weight: 500;
            color: #495057;
        }
        
        .stat-value {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
        }
        
        .leaflet-popup-content {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .popup-title {
            font-weight: bold;
            font-size: 1.1em;
            color: #2c3e50;
            margin-bottom: 8px;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }
        
        .popup-info {
            margin: 6px 0;
            color: #495057;
        }
        
        .popup-label {
            font-weight: 600;
            color: #6c757d;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 300px;
            }
            
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸš‚ Ouverture du rail Ã  la concurrence</h1>
            <p class="subtitle">Lignes ferroviaires TER et TET - Ã‰tat des lieux au 17/11/2025</p>
        </header>
        
        <div class="main-content">
            <div class="sidebar">
                <div class="legend">
                    <h3>ðŸ“Š LÃ©gende</h3>
                    <div class="legend-item" data-status="attribue_SNCF">
                        <div class="legend-color" style="background: #3498db;"></div>
                        <div class="legend-label">AttribuÃ© SNCF</div>
                        <div class="legend-count" id="count-sncf">0</div>
                    </div>
                    <div class="legend-item" data-status="attribue_concurrent">
                        <div class="legend-color" style="background: #e74c3c;"></div>
                        <div class="legend-label">AttribuÃ© concurrent</div>
                        <div class="legend-count" id="count-concurrent">0</div>
                    </div>
                    <div class="legend-item" data-status="mis_en_concurrence_pas_attribue">
                        <div class="legend-color" style="background: #f39c12;"></div>
                        <div class="legend-label">Mis en concurrence (non attribuÃ©)</div>
                        <div class="legend-count" id="count-concurrence">0</div>
                    </div>
                </div>
                
                <div class="stats">
                    <h3>ðŸ“ˆ Statistiques</h3>
                    <div class="stat-item">
                        <span class="stat-label">Total lignes</span>
                        <span class="stat-value" id="total-lignes">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Lignes TER</span>
                        <span class="stat-value" id="total-ter">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Lignes TET</span>
                        <span class="stat-value" id="total-tet">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">RÃ©gions concernÃ©es</span>
                        <span class="stat-value" id="total-regions">0</span>
                    </div>
                </div>
            </div>
            
            <div id="map"></div>
        </div>
    </div>

    <script>
        // CoordonnÃ©es approximatives des principales villes franÃ§aises
        const villes = {
            "Paris": [48.8566, 2.3522],
            "Marseille": [43.2965, 5.3698],
            "Lyon": [45.7640, 4.8357],
            "Toulouse": [43.6047, 1.4442],
            "Nice": [43.7102, 7.2620],
            "Nantes": [47.2184, -1.5536],
            "Strasbourg": [48.5734, 7.7521],
            "Montpellier": [43.6108, 3.8767],
            "Bordeaux": [44.8378, -0.5792],
            "Lille": [50.6292, 3.0573],
            "Rennes": [48.1173, -1.6778],
            "Reims": [49.2583, 4.0317],
            "Le Havre": [49.4944, 0.1079],
            "Saint-Ã‰tienne": [45.4397, 4.3872],
            "Toulon": [43.1242, 5.9280],
            "Grenoble": [45.1885, 5.7245],
            "Dijon": [47.3220, 5.0415],
            "Angers": [47.4784, -0.5632],
            "NÃ®mes": [43.8367, 4.3601],
            "Villeurbanne": [45.7662, 4.8792],
            "Clermont-Ferrand": [45.7772, 3.0870],
            "Aix-en-Provence": [43.5297, 5.4474],
            "Brest": [48.3904, -4.4861],
            "Tours": [47.3941, 0.6848],
            "Amiens": [49.8941, 2.2958],
            "Limoges": [45.8336, 1.2611],
            "Annecy": [45.8992, 6.1294],
            "Perpignan": [42.6886, 2.8948],
            "BesanÃ§on": [47.2380, 6.0243],
            "OrlÃ©ans": [47.9029, 1.9093],
            "Metz": [49.1193, 6.1757],
            "Rouen": [49.4432, 1.0993],
            "Mulhouse": [47.7508, 7.3359],
            "Caen": [49.1829, -0.3707],
            "Nancy": [48.6921, 6.1844],
            "Argenteuil": [48.9474, 2.2475],
            "Montreuil": [48.8634, 2.4431],
            "Saint-Denis": [48.9356, 2.3539],
            "Roubaix": [50.6942, 3.1746],
            "Tourcoing": [50.7236, 3.1609],
            "Avignon": [43.9493, 4.8055],
            "Poitiers": [46.5802, 0.3404],
            "Dunkerque": [51.0343, 2.3768],
            "CrÃ©teil": [48.7904, 2.4555],
            "Pau": [43.2951, -0.3708],
            "Calais": [50.9513, 1.8587],
            "La Rochelle": [46.1603, -1.1511],
            "Cannes": [43.5528, 7.0174],
            "Antibes": [43.5808, 7.1251],
            "Colmar": [48.0794, 7.3581],
            "Bourges": [47.0842, 2.3988],
            "Quimper": [47.9960, -4.0970],
            "Valence": [44.9334, 4.8924],
            "Troyes": [48.2973, 4.0744],
            "Cholet": [47.0586, -0.8798],
            "Niort": [46.3236, -0.4593],
            "ChambÃ©ry": [45.5646, 5.9178],
            "Lorient": [47.7482, -3.3703],
            "Beauvais": [49.4295, 2.0807],
            "Ã‰pinal": [48.1747, 6.4502],
            "Charleville-MÃ©ziÃ¨res": [49.7719, 4.7196],
            "Laon": [49.5637, 3.6250],
            "Saint-Quentin": [49.8484, 3.2872],
            "Cherbourg": [49.6337, -1.6222],
            "Chateaubriand": [47.7167, -1.3761],
            "Clisson": [47.0867, -1.2819],
            "Pornic": [47.1156, -2.1025],
            "LaRoche-sur-yon": [46.6703, -1.4269],
            "LesSablesd'olonne": [46.4967, -1.7833],
            "Gap": [44.5594, 6.0797],
            "BrianÃ§on": [44.8978, 6.6431],
            "Vintimille": [43.7896, 7.5081],
            "Grasse": [43.6584, 6.9222],
            "Tende": [44.0889, 7.5942],
            "HyÃ¨res": [43.1204, 6.1286],
            "Pertuis": [43.6942, 5.5022],
            "Miramas": [43.5847, 5.0036],
            "Carpentras": [44.0556, 5.0486],
            "Coutances": [49.0478, -1.4456],
            "Saint-LÃ´": [49.1150, -1.0914],
            "Evreux": [49.0247, 1.1510],
            "Lisieux": [49.1467, 0.2256],
            "Granville": [48.8372, -1.5973],
            "Trouville-Deauville": [49.3667, 0.0778],
            "Dives-Cabourg": [49.2867, -0.0989],
            "AngoulÃªme": [45.6484, 0.1562],
            "Saintes": [45.7467, -0.6333],
            "Royan": [45.6228, -1.0281],
            "ChÃ¢tellerault": [46.8178, 0.5461],
            "Rochefort": [45.9367, -0.9608],
            "MÃ¢con": [46.3067, 4.8314],
            "Cosne": [47.4092, 2.9270],
            "Moulins": [46.5667, 3.3333],
            "Chagny": [46.9097, 4.7517],
            "Nevers": [46.9897, 3.1603],
            "Montchanin": [46.7497, 4.4728],
            "Paray": [46.4519, 4.1194],
            "Contrexville": [48.1828, 5.8914],
            "Saint-Die-des-vosges": [48.2897, 6.9497],
            "SÃ©lestat": [48.2600, 7.4528],
            "Molsheim": [48.5433, 7.4928],
            "Trier": [49.7500, 6.6371],
            "SaarbrÃ¼cken": [49.2333, 6.9667],
            "Wissembourg": [49.0386, 7.9447],
            "Neustadt": [49.3500, 8.1333],
            "Lauterbourg": [48.9756, 8.1778],
            "WÃ¶rth": [48.9333, 8.2500],
            "Karlsruhe": [49.0069, 8.4037],
            "Offenburg": [48.4722, 7.9403],
            "MÃ¼llheim": [47.8094, 7.6289],
            "Epernay": [49.0431, 3.9597],
            "ChÃ¢teauThierry": [49.0458, 3.4033],
            "ChampagneArdenneTGV": [49.2317, 4.0475],
            "Sedan": [49.7019, 4.9392],
            "Givet": [50.1378, 4.8264],
            "Hirson": [49.9214, 4.0817],
            "Longuyon": [49.4475, 5.5997],
            "Longwy": [49.5189, 5.7606],
            "Thionville": [49.3589, 6.1653],
            "ChÃ¢lons-en-Champagne": [48.9533, 4.3631],
            "Saint-Dizier": [48.6381, 4.9497],
            "Chaumont": [48.1119, 5.1392],
            "Culmont-Chalindrey": [47.8225, 5.3306],
            "Fismes": [49.3092, 3.6800],
            "Tergnier": [49.6567, 3.2967],
            "Albert": [50.0025, 2.6519],
            "Abbeville": [50.1058, 1.8336],
            "Abancourt": [49.6908, 1.7739],
            "LeTrÃ©port": [50.0619, 1.3744],
            "Creil": [49.2586, 2.4736],
            "Montdidier": [49.6472, 2.5694],
            "CompiÃ¨gne": [49.4177, 2.8260],
            "Roissy": [49.0097, 2.5479],
            "Saint-pol-sur-ternoise": [50.3814, 2.3364],
            "Arras": [50.2919, 2.7778],
            "BÃ©thune": [50.5292, 2.6403],
            "Etaples": [50.5181, 1.6431],
            "Nort-sur-Erdre": [47.4389, -1.4981],
            "Saint-Gilles-Croix-de-vie": [46.6972, -1.9392],
            "LesArcsDraguignan": [43.4644, 6.4789],
            "Breil-sur-Roya": [43.9372, 7.5150],
            "Aubagne": [43.2928, 5.5708],
            "Romans": [45.0444, 5.0514],
            "Maubeuge": [50.2778, 3.9731],
            "Cambrai": [50.1761, 3.2347]
        };

        // Fonction pour obtenir les coordonnÃ©es d'une ville
        function getCoords(nomVille) {
            const villeNormalisee = Object.keys(villes).find(v => 
                v.toLowerCase() === nomVille.toLowerCase() || 
                nomVille.toLowerCase().includes(v.toLowerCase()) ||
                v.toLowerCase().includes(nomVille.toLowerCase())
            );
            return villes[villeNormalisee] || null;
        }

        // Couleurs selon le statut
        const couleurs = {
            "attribue_SNCF": "#3498db",
            "attribue_concurrent": "#e74c3c",
            "mis_en_concurrence_pas_attribue": "#f39c12"
        };

        // Initialisation de la carte
        const map = L.map('map').setView([46.603354, 1.888334], 6);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors',
            maxZoom: 18
        }).addTo(map);

        // DonnÃ©es intÃ©grÃ©es directement
        const data = {
            "meta": {
                "description": "Lignes ferroviaires mentionnÃ©es dans l'infographie Contexte sur l'ouverture Ã  la concurrence (TER + TET, hors ÃŽle-de-France et Corse).",
                "source": "Contexte, article 'Ouverture du rail Ã  la concurrence : les rÃ©gions en ordre dispersÃ©'",
                "date_article": "2025-11-17"
            },
            "lignes": [
                {"region": "Bourgogne-Franche-ComtÃ©", "type_marche": "TER", "lot": "Bourgogne-Ouest-Nivernais", "relation": "Dijon>MÃ¢con", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Bourgogne-Franche-ComtÃ©", "type_marche": "TER", "lot": "Bourgogne-Ouest-Nivernais", "relation": "Cosne>Moulins", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Bourgogne-Franche-ComtÃ©", "type_marche": "TER", "lot": "Bourgogne-Ouest-Nivernais", "relation": "Chagny>Nevers", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Bourgogne-Franche-ComtÃ©", "type_marche": "TER", "lot": "Bourgogne-Ouest-Nivernais", "relation": "Montchanin>Paray", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Bourgogne-Franche-ComtÃ©", "type_marche": "TER", "lot": "Bourgogne-Ouest-Nivernais", "relation": "Lyon>Moulins", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Nancy-ContrexÃ©ville", "relation": "Nancy>Contrexville", "statut": "attribue_concurrent", "operateur": "Transdev (groupement NGE/Banque des Territoires)"},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Bruche-PiÃ©mont-Vosges", "relation": "Ã‰pinal>Saint-Die-des-vosges>Strasbourg", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Bruche-PiÃ©mont-Vosges", "relation": "SÃ©lestat>Molsheim>Strasbourg", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Metz>Trier", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Metz>SaarbrÃ¼cken", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Strasbourg>SaarbrÃ¼cken", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Strasbourg>Wissembourg>Neustadt", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Strasbourg>Lauterbourg>WÃ¶rth>Karlsruhe", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Strasbourg>Offenburg", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Lot transfrontalier", "relation": "Mulhouse>MÃ¼llheim", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "Epernay>Reims>ChÃ¢teauThierry", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "ChampagneArdenneTGV>Reims>Charleville-MÃ©ziÃ¨res>Sedan", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "Charleville-MÃ©ziÃ¨res>Givet", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "Charleville-mÃ©ziÃ¨res>Hirson>Longuyon>Longwy", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "Reims>ChÃ¢lons-en-Champagne>Saint-Dizier>Chaumont>Culmont-Chalindrey>Dijon", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "Reims>Fismes", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Grand Est", "type_marche": "TER", "lot": "Ã‰toile de Reims", "relation": "Reims>Laon", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Tergnier>Laon", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Saint-Quentin", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Albert>Lille", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Abbeville", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Beauvais>Abancourt>LeTrÃ©port", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Creil", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Montdidier>CompiÃ¨gne", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile d'Amiens", "relation": "Amiens>Rouen", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Radiales parisiennes", "relation": "Paris>Creil>Amiens>Calais", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Radiales parisiennes", "relation": "Paris>Creil>CompiÃ¨gne>Saint-Quentin>Maubeuge", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Radiales parisiennes", "relation": "Paris>Laon", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Radiales parisiennes", "relation": "Beauvais>Paris", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Radiales parisiennes", "relation": "Amiens>Creil>Roissy", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Radiales parisiennes", "relation": "Saint-Quentin>Creil>Roissy", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile de Saint-Pol-sur-Ternoise", "relation": "Saint-pol-sur-ternoise>Arras", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile de Saint-Pol-sur-Ternoise", "relation": "Saint-pol-sur-ternoise>BÃ©thune", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Hauts-de-France", "type_marche": "TER", "lot": "Ã‰toile de Saint-Pol-sur-Ternoise", "relation": "Saint-pol-sur-ternoise>Etaples", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Tram-train", "relation": "Nantes>Nort-sur-Erdre", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Tram-train", "relation": "Nantes>Chateaubriand", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Tram-train", "relation": "Nantes>Clisson", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Sud Loire", "relation": "Nantes>Pornic", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Sud Loire", "relation": "Nantes>Saint-Gilles-Croix-de-vie", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Sud Loire", "relation": "Nantes>LaRoche-sur-yon>LesSablesd'olonne", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Sud Loire", "relation": "Nantes>LaRochelle", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Sud Loire", "relation": "Nantes>Cholet", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Pays de la Loire", "type_marche": "TER", "lot": "Sud Loire", "relation": "Angers>Cholet", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "IntermÃ©tropoles", "relation": "Marseille>Toulon>Nice", "statut": "attribue_concurrent", "operateur": "Transdev"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Azur", "relation": "LesArcsDraguignan>Nice>Vintimille", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Azur", "relation": "Cannes>Grasse", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Azur", "relation": "Nice>Breil-sur-Roya>Tende", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 3", "relation": "Marseille>Aubagne>Toulon>HyÃ¨res", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 3", "relation": "Marseille>Toulon>LesArcsDraguignan", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 3", "relation": "Marseille>Aix-en-provence>Pertuis", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 3", "relation": "Marseille>Gap>BrianÃ§on", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 3", "relation": "BrianÃ§on>Gap>Valence>Romans", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 4", "relation": "Marseille>Miramas", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 4", "relation": "Marseille>Avignon", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 4", "relation": "Marseille>Avignon>Valence>Lyon", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 4", "relation": "Marseille>NÃ®mes>Montpellier", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Provence-Alpes-CÃ´te d'Azur", "type_marche": "TER", "lot": "Lot 4", "relation": "Avignon>Carpentras", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Coutances", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Saint-LÃ´", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Evreux", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Cherbourg", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Rouen", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Lisieux", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Granville", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Caen>Rennes", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Lisieux>Trouville-Deauville", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Normandie", "type_marche": "TER", "lot": "Ã‰toile de Caen", "relation": "Trouville-Deauville>Dives-Cabourg", "statut": "attribue_concurrent", "operateur": "RATP"},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "LaRochelle>Rochefort>Saintes>Bordeaux", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "AngoulÃªme>Saintes>Royan", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "Niort>Saintes>Royan", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "Poitiers>Niort>LaRochelle", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "Tours>ChÃ¢tellerault>Poitiers", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "Poitiers>AngoulÃªme", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "ChÃ¢tellerault>Poitiers>AngoulÃªme", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "Nouvelle-Aquitaine", "type_marche": "TER", "lot": "Poitou-charentes", "relation": "AngoulÃªme>Bordeaux", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "France entiÃ¨re (Ã‰tat)", "type_marche": "TET", "lot": "Bordeaux, Nantes, Lyon", "relation": "Nantes>Bordeaux", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "France entiÃ¨re (Ã‰tat)", "type_marche": "TET", "lot": "Bordeaux, Nantes, Lyon", "relation": "Nantes>Lyon", "statut": "attribue_SNCF", "operateur": "SNCF"},
                {"region": "France entiÃ¨re (Ã‰tat)", "type_marche": "TET", "lot": "ParisClermont", "relation": "Paris>Clermont-Ferrand", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""},
                {"region": "France entiÃ¨re (Ã‰tat)", "type_marche": "TET", "lot": "ParisLimogesToulouse", "relation": "Paris>Limoges>Toulouse", "statut": "mis_en_concurrence_pas_attribue", "operateur": ""}
            ]
        };
        
        const lignes = data.lignes;
                
                // Statistiques
                let countSNCF = 0;
                let countConcurrent = 0;
                let countConcurrence = 0;
                let countTER = 0;
                let countTET = 0;
                const regions = new Set();
                
                // Dessiner les lignes
                lignes.forEach(ligne => {
                    const villes = ligne.relation.split('>');
                    const coords = [];
                    
                    villes.forEach(ville => {
                        const coord = getCoords(ville.trim());
                        if (coord) {
                            coords.push(coord);
                        }
                    });
                    
                    if (coords.length >= 2) {
                        const polyline = L.polyline(coords, {
                            color: couleurs[ligne.statut],
                            weight: 4,
                            opacity: 0.7
                        }).addTo(map);
                        
                        const operateurTexte = ligne.operateur || "Non attribuÃ©";
                        
                        polyline.bindPopup(`
                            <div class="popup-title">${ligne.relation}</div>
                            <div class="popup-info"><span class="popup-label">RÃ©gion:</span> ${ligne.region}</div>
                            <div class="popup-info"><span class="popup-label">Type:</span> ${ligne.type_marche}</div>
                            <div class="popup-info"><span class="popup-label">Lot:</span> ${ligne.lot}</div>
                            <div class="popup-info"><span class="popup-label">OpÃ©rateur:</span> ${operateurTexte}</div>
                        `);
                    }
                    
                    // Compter les statistiques
                    if (ligne.statut === "attribue_SNCF") countSNCF++;
                    else if (ligne.statut === "attribue_concurrent") countConcurrent++;
                    else if (ligne.statut === "mis_en_concurrence_pas_attribue") countConcurrence++;
                    
                    if (ligne.type_marche === "TER") countTER++;
                    else if (ligne.type_marche === "TET") countTET++;
                    
                    regions.add(ligne.region);
                });
                
                // Mise Ã  jour des compteurs
                document.getElementById('count-sncf').textContent = countSNCF;
                document.getElementById('count-concurrent').textContent = countConcurrent;
                document.getElementById('count-concurrence').textContent = countConcurrence;
                document.getElementById('total-lignes').textContent = lignes.length;
                document.getElementById('total-ter').textContent = countTER;
                document.getElementById('total-tet').textContent = countTET;
                document.getElementById('total-regions').textContent = regions.size;
    </script>
</body>
</html>
